<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>è»€é«”åŒ–æ¨¡æ“¬å°è©±</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        #chat-box { height: 400px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px; margin-bottom: 10px; background: #f9f9f9; }
        .message { margin: 10px 0; }
        .user { text-align: right; color: blue; }
        .bot { text-align: left; color: darkgreen; }
        .status { font-size: 0.9em; color: gray; margin-bottom: 10px; }
        #input-area { display: flex; }
        input { flex: 1; padding: 10px; }
        button { padding: 10px 20px; }
    </style>
</head>
<body>

    <h2>æ¨¡æ“¬å€‹æ¡ˆï¼šå°é›…</h2>
    <div class="status">ç›®å‰ä¿¡ä»»åº¦ï¼š<span id="trust-display">20</span>/100</div>
    
    <div id="chat-box"></div>

    <div id="input-area">
        <input type="text" id="user-input" placeholder="è©¦è‘—å›æ‡‰å¥¹çš„æŠ±æ€¨..." />
        <button onclick="sendMessage()">ç™¼é€</button>
    </div>

    <script>
        // ç”¢ç”Ÿä¸€å€‹éš¨æ©Ÿ ID ä»£è¡¨é€™å€‹ä½¿ç”¨è€… (ç°¡å–®å¯¦ä½œ)
        const userId = "user_" + Math.floor(Math.random() * 10000);
        const chatBox = document.getElementById('chat-box');

        async function sendMessage() {
            const inputField = document.getElementById('user-input');
            const message = inputField.value;
            if (!message) return;

            // 1. é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
            addMessage(message, 'user');
            inputField.value = '';

            // 2. å‚³é€åˆ°ä½ çš„ Python Server (å‡è¨­åœ¨ localhost:8000)
            try {
                const response = await fetch('http://127.0.0.1:8000/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, message: message })
                });

                const data = await response.json();

                // 3. é¡¯ç¤º AI å›æ‡‰èˆ‡æ›´æ–°ä¿¡ä»»åº¦
                addMessage(data.reply, 'bot');
                document.getElementById('trust-display').innerText = data.current_trust;

                if (data.goal_achieved) {
                    alert("ğŸ‰ æ­å–œï¼ä½ æˆåŠŸå¼•å°å€‹æ¡ˆé¡˜æ„æ¥å—è«®å•†ï¼");
                }

            } catch (error) {
                console.error('Error:', error);
                addMessage("ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¢ºèª Server æ˜¯å¦å·²å•Ÿå‹•ã€‚", 'bot');
            }
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.innerText = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>
