<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
  body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
  .box { border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
  .msg { margin: 5px; padding: 8px; border-radius: 5px; }
  .user { text-align: right; background: #e3f2fd; }
  .bot { text-align: left; background: #f1f1f1; }
</style>
</head>
<body>
<h2>軀體化模擬個案</h2>
<div>信任度: <span id="trust">20</span></div>
<div id="box" class="box"></div>
<input id="in" type="text" style="width:70%"><button onclick="send()">送出</button>

<script>
  // ▼▼▼ 貼上你的 Function URL ▼▼▼
  const URL = "http://localhost:7071/api/chat";

  async function send() {
    let txt = document.getElementById("in").value;
    if(!txt) return;
    add(txt, "user");
    document.getElementById("in").value="";
    
    try {
        let res = await fetch(URL, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({user_id: "test", message: txt})
        });
        let data = await res.json();
        add(data.reply, "bot");
        document.getElementById("trust").innerText = data.trust;
        if(data.goal) alert("通關成功！");
    } catch(e) {
        add("錯誤: " + e, "bot");
    }
  }
  function add(t, c) {
    let d = document.createElement("div");
    d.className = "msg " + c; d.innerText = t;
    document.getElementById("box").appendChild(d);
  }
</script>
</body>
</html>